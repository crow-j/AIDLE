import os
import numpy as np
import pandas as pd

def parsing(folder):
    file_list = os.listdir(folder)
    
    headers_df = pd.DataFrame()
    
    for i, file in enumerate(file_list):
        if file == '.ipynb_checkpoints' or file =='eml':
            continue
        
        header = {}
        f = open(os.path.join(folder, file), 'r', encoding='utf-8' )
        column = ''
        isbody = False
        while True:
            line = f.readline()
            # 메일 header만 읽기
            if not line:
                break
                
            if '<html>' in line:
                isbody = True
                header['body'] = ''
            if isbody == True:
                header['body'] += line
            else:
                data = line.split(':')
                if len(data) >= 2 and '\t' not in line:
                    column = data[0]
                    value = data[1].replace('\n','')
                    header[column] = value
                else:
                    header[column] += line
        header_df = pd.DataFrame(header, index = [i])
        headers_df = pd.concat([headers_df, header_df])
    return headers_df
        
    headers_df = parsing('dataset')
    
    headers_df.to_csv('./test.csv')
